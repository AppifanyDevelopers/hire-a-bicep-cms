
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
  <style>

    /* Flatpickr calendar */
    .flatpickr-calendar {
      border-radius: 26px !important;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      overflow: hidden;
      font-family: sans-serif;
      padding-bottom: 10px;
      z-index: 1000;
      width: 280px;
      background: white;
    }

    /* Hide default month name */
    .flatpickr-months .flatpickr-current-month .cur-month {
      display: none;
    }

    /* Container for custom header with prev/next */
    .flatpickr-months {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 20px;
      background: white;
    }

    /* Custom date header text */
    .custom-date-header {
      font-weight: 600;
      font-size: 16px;
      user-select: none;
      color: #163651;
      flex: 1;
    }

    /* Navigation buttons container */
    .nav-buttons {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Prev and next buttons styles */
    .flatpickr-prev-month,
    .flatpickr-next-month {
      cursor: pointer;
      user-select: none;
      font-size: 16px;
      color: #163651;
      padding: 6px 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: background-color 0.2s;
      font-weight: bold;
      width: 28px;
      height: 28px;
      background: transparent;
      border: none;
    }
    
    .flatpickr-prev-month:hover,
    .flatpickr-next-month:hover {
      background-color: #e0e6ed;
    }

    /* Weekdays with single letters */
    .flatpickr-weekdays {
      background: transparent;
      padding: 8px 0;
    }
    
    .flatpickr-weekday {
      font-weight: 600;
      font-size: 14px;
      color: #555;
      width: 36px;
      line-height: 1;
      text-align: center;
    }

    /* Day cells */
    .flatpickr-day {
      width: 36px;
      height: 36px;
      line-height: 36px;
      border-radius: 8px;
      font-size: 14px;
      margin: 1px;
    }

    /* Selected day styles */
    .flatpickr-day.selected,
    .flatpickr-day.startRange,
    .flatpickr-day.endRange {
      background: #163651 !important;
      color: #fff !important;
      border-radius: 12px !important;
    }

    .flatpickr-day.today {
      border-color: #163651 !important;
      color: #163651 !important;
      font-weight: bold;
    }

    /* Hide default month container */
    .flatpickr-current-month {
      display: none !important;
    }

    .flatpickr-confirm {
      background-color: #163651;
      color: #fff;
      border: none;
      padding: 12px 0;
      margin: 15px 20px 5px 20px;
      border-radius: 26px;
      cursor: pointer;
      display: block;
      font-size: 16px;
      width: calc(100% - 40px);
      font-weight: 600;
      letter-spacing: 0.05em;
      transition: background-color 0.2s;
    }

    .flatpickr-confirm:hover {
      background-color: #0f2a3d;
    }

    .flatpickr-hidden {
      display: none !important;
    }

    /* Days container */
    .flatpickr-days {
      padding: 0 10px;
    }
  </style>

  <button id="datePickerTrigger" class="filter-select">Date</button>
  <input type="text" id="dateInput" hidden />


  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const dateInput = document.getElementById("dateInput");
      const dateBtn = document.getElementById("datePickerTrigger");
      let calendarVisible = false;

      // Weekday single letters
      const weekdayLabels = ["S", "M", "T", "W", "T", "F", "S"];

      // Helper to get ordinal suffix for a number (1st, 2nd, 3rd, 4th...)
      function getOrdinal(n) {
        const s = ["th", "st", "nd", "rd"],
              v = n % 100;
        return n + (s[(v - 20) % 10] || s[v] || s[0]);
      }

      // Format date as "4th Aug, 2025"
      function formatFullDate(date) {
        if (!date) return "";
        const day = getOrdinal(date.getDate());
        const month = date.toLocaleString(undefined, { month: "short" });
        const year = date.getFullYear();
        return `${day} ${month}, ${year}`;
      }

      const fp = flatpickr(dateInput, {
        inline: true,
        appendTo: document.body,
        clickOpens: false,
        defaultDate: new Date(),

        onReady: function (selectedDates, dateStr, instance) {
          // Replace weekday labels with single letters
          const weekdays = instance.weekdayContainer.querySelectorAll(".flatpickr-weekday");
          weekdays.forEach((dayElem, i) => {
            dayElem.textContent = weekdayLabels[i];
          });

          // Clear and rebuild the month container
          const monthContainer = instance.calendarContainer.querySelector(".flatpickr-months");
          monthContainer.innerHTML = "";

          // Custom header text
          const customHeader = document.createElement("div");
          customHeader.classList.add("custom-date-header");
          customHeader.textContent = formatFullDate(instance.selectedDates[0] || new Date());

          // Navigation buttons container
          const navButtons = document.createElement("div");
          navButtons.classList.add("nav-buttons");

          // Prev arrow
          const prevBtn = document.createElement("button");
          prevBtn.classList.add("flatpickr-prev-month");
          prevBtn.innerHTML = "&#8249;"; // Left angle bracket
          prevBtn.type = "button";
          prevBtn.addEventListener("click", (e) => {
            e.preventDefault();
            e.stopPropagation();
            instance.changeMonth(-1);
            updateHeader();
          });

          // Next arrow  
          const nextBtn = document.createElement("button");
          nextBtn.classList.add("flatpickr-next-month");
          nextBtn.innerHTML = "&#8250;"; // Right angle bracket
          nextBtn.type = "button";
          nextBtn.addEventListener("click", (e) => {
            e.preventDefault();
            e.stopPropagation();
            instance.changeMonth(1);
            updateHeader();
          });

          navButtons.appendChild(prevBtn);
          navButtons.appendChild(nextBtn);

          monthContainer.appendChild(customHeader);
          monthContainer.appendChild(navButtons);

          // Update header text function
          function updateHeader() {
            const currentDate = new Date(instance.currentYear, instance.currentMonth, 1);
            customHeader.textContent = formatFullDate(currentDate);
          }

          // Create and append the Apply button
          const confirmBtn = document.createElement("button");
          confirmBtn.textContent = "Apply";
          confirmBtn.className = "flatpickr-confirm";
          confirmBtn.type = "button";

          confirmBtn.addEventListener("click", (e) => {
            e.preventDefault();
            e.stopPropagation();
            instance.close();
            calendarVisible = false;
            if (instance.selectedDates.length > 0) {
              dateBtn.textContent = instance.formatDate(instance.selectedDates[0], "F j, Y");
            }
            instance.calendarContainer.classList.add("flatpickr-hidden");
          });

          instance.calendarContainer.appendChild(confirmBtn);
          instance.calendarContainer.classList.add("flatpickr-hidden");

          // Initial header update
          updateHeader();
        },

        onChange: function(selectedDates, dateStr, instance) {
          // Update header when date is selected
          const customHeader = instance.calendarContainer.querySelector(".custom-date-header");
          if (customHeader && selectedDates.length > 0) {
            customHeader.textContent = formatFullDate(selectedDates[0]);
          }
        }
      });

      // Show/hide calendar on button click
      dateBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        if (calendarVisible) {
          fp.calendarContainer.classList.add("flatpickr-hidden");
        } else {
          fp.calendarContainer.classList.remove("flatpickr-hidden");
        }
        calendarVisible = !calendarVisible;
      });

      // Hide calendar on outside click
      document.addEventListener("click", function (e) {
        if (!fp.calendarContainer.contains(e.target) && e.target !== dateBtn) {
          fp.calendarContainer.classList.add("flatpickr-hidden");
          calendarVisible = false;
        }
      });
    });
  </script>
